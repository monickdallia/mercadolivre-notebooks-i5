# -*- coding: utf-8 -*-
"""app.py

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1MyuOCjW1fbk6lV9Aj_cHqrh-ueMc7aDG
"""
import streamlit as st
import pandas as pd
import plotly.express as px

# ConfiguraÃ§Ãµes da pÃ¡gina
st.set_page_config(page_title="Dashboard Mercado Livre - Notebooks", layout="wide")
st.title("ðŸ’» Dashboard - Notebooks Mercado Livre")
st.markdown("AnÃ¡lise de preÃ§os de notebooks com dados coletados automaticamente via web scraping.")

# Carregar dados com cache e tempo de expiraÃ§Ã£o
@st.cache_data(ttl=600)  # 10 minutos
def carregar_dados():
    return pd.read_csv("notebooks_mel.csv")

df = carregar_dados()

# Tratar colunas e normalizar marca
df.columns = [col.strip().lower().replace(" ", "_") for col in df.columns]
df["marca"] = df["marca"].str.strip().str.lower().str.capitalize()

# Mostrar data da coleta 
data_coleta = pd.to_datetime(df["data"]).max().strftime('%d/%m/%Y')
st.markdown(f"ðŸ“… Dados coletados em: **{data_coleta}**")

# Filtros
marcas = sorted(df["marca"].dropna().unique())
marca_selecionada = st.sidebar.multiselect("ðŸ” Filtrar por marca", marcas, default=marcas)

# Faixa de preÃ§o com base no preÃ§o promocional
preco_min = int(df["Preco_promocional"].min())
preco_max = int(df["Preco_promocional"].max())
faixa_preco = st.sidebar.slider("ðŸ’° Filtrar por faixa de preÃ§o", preco_min, preco_max, (preco_min, preco_max))

# Aplicar filtros com base no preÃ§o promocional
df_filtrado = df[
    (df["marca"].isin(marca_selecionada)) &
    (df["Preco_promocional"] >= faixa_preco[0]) &
    (df["Preco_promocional"] <= faixa_preco[1])
]

# GrÃ¡fico 1: PreÃ§o mÃ©dio por marca (promocional)
preco_medio = df_filtrado.groupby("marca")["Preco_promocional"].mean().reset_index()
fig1 = px.bar(preco_medio, x="marca", y="Preco_promocional", title="ðŸ’° PreÃ§o MÃ©dio por Marca (Promocional)", text_auto='.2s')
fig1.update_layout(xaxis_title="Marca", yaxis_title="PreÃ§o Promocional (R$)", template="plotly_white")

# GrÃ¡fico 2: DistribuiÃ§Ã£o de preÃ§os promocionais
fig2 = px.histogram(df_filtrado, x="Preco_promocional", nbins=30, title="ðŸ“Š DistribuiÃ§Ã£o de PreÃ§os Promocionais")
fig2.update_layout(xaxis_title="PreÃ§o Promocional (R$)", yaxis_title="Quantidade", template="plotly_white")

# GrÃ¡fico 3: Top 10 mais caros (promocional)
top10 = df_filtrado.sort_values(by="Preco_promocional", ascending=False).head(10)
fig3 = px.bar(top10, x="Preco_promocional", y="nome", orientation="h", title="ðŸ·ï¸ Top 10 Notebooks Mais Caros (Promo)", text_auto='.2s')
fig3.update_layout(xaxis_title="PreÃ§o Promocional (R$)", yaxis_title="TÃ­tulo", template="plotly_white")

# Layout de grÃ¡ficos
col1, col2 = st.columns(2)
col1.plotly_chart(fig1, use_container_width=True)
col2.plotly_chart(fig2, use_container_width=True)

st.plotly_chart(fig3, use_container_width=True)

# Tabela interativa com ordenaÃ§Ã£o pelo preÃ§o promocional
st.markdown("### ðŸ“‹ Tabela de Dados Filtrados")
colunas_visiveis = ["nome", "marca", "preco", "Preco_promocional", "link"]
st.dataframe(df_filtrado[colunas_visiveis].sort_values(by="preco_promocional", ascending=False), use_container_width=True)

